<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NICAS: nicas</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NICAS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">nicas </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Welcome to the documentation for the software NICAS.</p>
<p>Contact: <a href="#" onclick="location.href='mai'+'lto:'+'ben'+'ja'+'min'+'.m'+'ene'+'tr'+'ier'+'@m'+'ete'+'o.'+'fr'; return false;">benja<span style="display: none;">.nosp@m.</span>min.<span style="display: none;">.nosp@m.</span>menet<span style="display: none;">.nosp@m.</span>rier<span style="display: none;">.nosp@m.</span>@mete<span style="display: none;">.nosp@m.</span>o.fr</a></p>
<p>To download the code:</p><ul>
<li><a href="https://opensource.cnrm-game-meteo.fr/projects/nicas/files" target="_blank">archives page</a></li>
<li>git repository: git clone git://opensource.cnrm-game-meteo.fr/nicas.git .</li>
</ul>
<h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>The software <b>NICAS</b> aims at computing coefficients for a localization method based on a Normalized Interpolated Convolution on an Adaptive Subgrid.</p>
<p>Already available input models are: <a href="http://www.cnrm-game-meteo.fr/spip.php?article121&amp;lang=en" target="_blank">ARPEGE</a>, <a href="http://www.cnrm-game-meteo.fr/spip.php?article120&amp;lang=en" target="_blank">AROME</a>, <a href="https://en.wikipedia.org/wiki/Global_Environmental_Multiscale_Model" target="_blank">GEM</a>, <a href="https://gmao.gsfc.nasa.gov/GEOS" target="_blank">GEOS</a>, <a href="https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs" target="_blank">GFS</a>, <a href="http://www.ecmwf.int/en/research/modelling-and-prediction" target="_blank">IFS</a>, <a href="https://mpas-dev.github.io" target="_blank">MPAS</a>, <a href="http://www.nemo-ocean.eu" target="_blank">NEMO</a> and <a href="http://www.wrf-model.org" target="_blank">WRF</a>.</p>
<p>Code size and characterics can be found in the <a href="http://benjaminmenetrier.free.fr/nicas/html/CLOC_REPORT.html" target="_blank">CLOC report</a>.</p>
<h1><a class="anchor" id="license"></a>
License</h1>
<p>The code is distributed under the CeCILL-B license (<a href="http://benjaminmenetrier.free.fr/nicas/html/LICENSE.html" target="_blank">LICENSE</a>).</p>
<h1><a class="anchor" id="Folders"></a>
Folders organization</h1>
<p>The main directory $MAINDIR contains six folders:</p><ul>
<li>build: cmake-generated files</li>
<li>data: data (only links script in the archive)</li>
<li>doc: documentation and support</li>
<li>ncl: <a href="http://ncl.ucar.edu" target="_blank">NCL</a> scripts to plot curves</li>
<li>run: executables and namelists</li>
<li>script: useful scripts</li>
<li>src: source code</li>
<li>test: test data</li>
</ul>
<p>They should have been created when unpacking the archive nicas.tar.gz or cloning the git repository.</p>
<h1><a class="anchor" id="Compilation"></a>
Compilation and dependencies</h1>
<p>The compilation of sources uses cmake (<a href="https://cmake.org" target="_blank">https://cmake.org</a>). Compilation options (compiler, build type, NetCDF library path) are specified in the file build/CMakeLists.txt. Then, to compile:</p><ul>
<li>cd build</li>
<li>cmake CMakeLists.txt</li>
<li>make</li>
</ul>
<p>An executable file run/nicas should be created if compilation is sucessful.</p>
<p>Input and output files use the NetCDF format. The NetCDF library can be downloaded at: <a href="http://www.unidata.ucar.edu/software/netcdf" target="_blank">http://www.unidata.ucar.edu/software/netcdf</a></p>
<p>Horizontal interpolations are performed with the tool ESMF_RegridWeightGen, available at: <a href="https://www.earthsystemcog.org/projects/esmf/" target="_blank">https://www.earthsystemcog.org/projects/esmf/</a>. A supplementary file must be generated in the scripts links.ksh, which use <a href="http://ncl.ucar.edu" target="_blank">NCL</a>.</p>
<h1><a class="anchor" id="code"></a>
Code structure</h1>
<p>The source code is organized in modules with several groups indicated by a prefix:</p><ul>
<li>nicas: main program</li>
<li>model_[...]: model related routines, to get the coordinates, read and write fields</li>
<li>module_[...]: generic computation routines</li>
<li>tools_[...]: useful tools for the whole code</li>
<li>type_[...]: derived types</li>
</ul>
<h1><a class="anchor" id="input"></a>
Input data</h1>
<p>A "grid.nc" file containing the coordinates of the model grid is used in every model_$MODEL_coord routine and should be placed in $DATADIR. The script "links.ksh" located in the $DATADIR folder can help you to generate it. A "grid_SCRIP.nc" file is also necessary to use ESMF as an interpolation tool.</p>
<p>If required by namelist keys Lbh_file and Lbv_file, input files containing the horizontal and vertical length-scales are read.</p>
<p>For the MPI splitting, a file $DATADIR/$PREFIX_distribution_$NPROC.nc is required, where $PREFIX and $NPROC is the number of MPI tasks formatted with 4 digits, both specified in the namelist.</p>
<h1><a class="anchor" id="output"></a>
Output data</h1>
<h2><a class="anchor" id="output_1"></a>
Mesh data</h2>
<p>The file $DATADIR/$PREFIX_mesh.nc contains informative data about the subgrid that are not required to apply the NICAS method.</p>
<h2><a class="anchor" id="output_2"></a>
Global parameters</h2>
<p>The file $DATADIR/$PREFIX_param.nc contains all the required paramters to apply the NICAS method on a single task. This file can also be used to bypass the parameters computations in a future restart.</p>
<h2><a class="anchor" id="output_3"></a>
Local parameters</h2>
<p>The file $DATADIR/$PREFIX_mpi-$MPI_$IPROC_$NPROC.nc all the required paramters to apply the NICAS method for task $IPROC among $NPROC tasks (both formatted with 4 digits), where $MPI is the number of communication steps (1 or 2, formatted with 1 digit). This file can also be used to bypass the parameters computations in a future restart.</p>
<h2><a class="anchor" id="output_3"></a>
Local parameters</h2>
<p>The file $DATADIR/$PREFIX_mpi-$MPI_$NPROC_summary.nc contains informative data about the MPI splitting that are not required to apply the NICAS method.</p>
<h1><a class="anchor" id="namelist"></a>
Namelists management</h1>
<p>Namelists can be found in $MAINDIR/run. They are also stored in the SQLite database $MAINDIR/script/namelist.sqlite. This database can be browsed with appropriate softwares like <a href="http://sqlitebrowser.org" target="_blank">SQLiteBrowser</a>.</p>
<p>To add or update a namelist in the database:</p><ul>
<li>cd $MAINDIR/script</li>
<li>./namelist_nam2sql.ksh $SUFFIX where $SUFFIX is the namelist suffix. If no $SUFFIX is specified, all namelists present in $MAINDIR/run are added or updated.</li>
</ul>
<p>To generate a namelist from the database:</p><ul>
<li>cd $MAINDIR/script</li>
<li>./namelist_sql2nam.ksh $SUFFIX where $SUFFIX is the namelist suffix. If no $SUFFIX is specified, all namelists present in the database are generated in $MAINDIR/run.</li>
</ul>
<h1><a class="anchor" id="running"></a>
Running the code</h1>
<p>To run the code on a single node, you have to edit a namelist located in the $MAINDIR/run directory, and then:</p><ul>
<li>cd $MAINDIR/run</li>
<li>export OMP_NUM_THREADS=$NTHREAD</li>
<li>mpirun &ndash;npernode $NTASK nicas &lt; namelist_$SUFFIX where $NTHREAD is the number of OpenMP threads and $NTASK is the number of MPI tasks that are desired.</li>
</ul>
<p>The script $MAINDIR/script/sbatch.ksh is available for multi-nodes executions with SBATCH.</p>
<h1><a class="anchor" id="ncl"></a>
NCL plots</h1>
<p>Various <a href="http://ncl.ucar.edu" target="_blank">NCL</a> scripts are available in $MAINDIR/ncl/script to plot data.</p>
<h1><a class="anchor" id="test"></a>
Test</h1>
<p>A simple test script is available in $MAINDIR/script:</p><ul>
<li>cd $MAINDIR/script</li>
<li>./test.ksh</li>
</ul>
<p>It uses data stored in $MAINDIR/test and calls the NetCDF tools ncdump.</p>
<h1><a class="anchor" id="model"></a>
Adding a new model</h1>
<p>To add a model $MODEL in nicas, you need to write a new module containing three routines:</p><ul>
<li>model_$MODEL_coord to get model coordinates</li>
<li>model_$MODEL_read to read a model field</li>
<li>model_$MODEL_write to write a model field</li>
</ul>
<p>You need also to add three calls to model_$MODEL_coord, model_$MODEL_read and model_$MODEL_write in routines model_coord, model_read and model_write, respectively, which are contained in the module <a class="el" href="namespacemodel__interface.html" title="Purpose: model routines   Author: Benjamin Menetrier   Licensing: this code is distributed under the ...">model_interface</a>.</p>
<p>Finally, you need to add a case for the namelist check in the routine namread, contained in the module <a class="el" href="namespacemodule__namelist.html" title="Purpose: namelist parameters management   Author: Benjamin Menetrier   Licensing: this code is distri...">module_namelist</a>.</p>
<p>For models with a regular grid, you can start from AROME, ARPEGE, IFS, GEM, GEOS, GFS, NEMO and WRF routines. For models with an unstructured grid, you can start from MPAS routines.</p>
<h1><a class="anchor" id="change_log"></a>
Change log</h1>
<p>A log of the code updates is available here: <a href="http://benjaminmenetrier.free.fr/nicas/html/CHANGE_LOG.html" target="_blank">CHANGE_LOG</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jul 31 2017 16:08:41 for NICAS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
